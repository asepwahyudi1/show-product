<!DOCTYPE html>
<html>
<head>
 <title>CRUD Firebase</title>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

 <!-- Bootstrap CSS -->

 <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" >
 <link rel="stylesheet" type="text/css" href="css/style.css">
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
 <script src="https://www.gstatic.com/firebasejs/5.4.2/firebase.js"></script>
 <script type="text/javascript">

  var config = {
    apiKey: "AIzaSyB-DJQEQgBgK0z6VSQJkePHP6s-AdDT3qg",
			authDomain: "fir-employees-a228d.firebaseapp.com",
			databaseURL: "https://show-Product-default-rtdb.firebaseio.com/",
			projectId: "fir-employees-a228d",
			storageBucket: "show-Product.appspot.com",
			messagingSenderId: "594574432902",
			appId: "1:594574432902:web:658956ad1b8968d8"
  };

  firebase.initializeApp(config); 

 </script>
</head>
<body>
 <a href="gefdhgf.html" class="btn btn-primary btnTambahData" data-toggle="modal" onclick="cleardata()" data-target="#exampleModal" style="margin-left: 85%; margin-top: 3%;">Tambah</a>
 <table class="table table-striped" id="tbl_list_user">
  <!-- <thead>
   <tr class="row">
    <th scope="col">Nama</th>
    <th scope="col">Harga</th>
    <th scope="col">Aksi</th>
   </tr>
  </thead> -->
  <div class="container" style="border-bottom: solid; margin-top: 3%;">
    <div class="row">
      <div class="col-sm" scope="col"><h5>Nama</h5>
      </div>
      <div class="col-sm" scope="col"><h5>Harga</h5>
      </div>
      <div class="col-sm" scope="col"><h5>Aksi</h5>
      </div>
    </div>
  </div>
 </table>


 <!-- Modal -->
 <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
   <div class="modal-content">
     
<!-- tambahakan -->

    <!-- <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLabel"></h5>
     <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">&times;</span>
     </button>
    </div> -->


<!-- nah -->

    <!-- <div class="container" style="border-bottom: solid; margin-top: 3%;">
    <div class="row">
      <label for="nama">Nama</label>
       <input type="text" name="nama" id="nama" class="form-control" placeholder="Masukkan nama" required="true">
      <div class="col-sm" scope="col"><h5>Harga</h5>
      </div>
      <div class="col-sm" scope="col"><h5>Aksi</h5>
      </div>
    </div>
  </div> -->

    <form action="" method="POST" enctype="multipart/form-data">
     <div class="modal-body">     
      <!-- <input type="hidden" name="id" id="id"> -->
      <div class="form-group">
       <label for="nama">Nama</label>
       <input type="text" name="nama" id="nama" class="form-control" placeholder="Masukkan nama" required="true">
      </div>
      <div class="form-group">
       <label for="Harga">Harga</label>
       <input type="Harga" name="Harga" id="Harga" class="form-control" placeholder="Masukkan Harga" required="true">
      </div>
      <div class="form-group">
    
    
      </div>
     </div>

     <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      <button type="button" class="btn btn-primary" onclick="tambahData()" data-dismiss="modal">Simpan</button>
     </div>
    </form>
   </div>
  </div>
 </div>

 <!-- <script src="js/jquery.js"></script>     -->

 <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
 <script src="js/jquery.easing.1.3.js"></script>
 <script src="js/bootstrap.min.js"></script>
 <script src="js/hm.js"></script>

 <script type="text/javascript">
  var database = firebase.database();
  var key = 0;

  database.ref("users").orderByKey().limitToLast(1).on('child_added',function(data) {
   key = parseInt(data.key, 10);
   key = key + 1;
  });

  database.ref('users').on('value', function(snapshot) {
   var count = 0;
   if(snapshot.exists()){
    $("#tbl_list_user tbody").remove(); 
    var content = '<tbody>';
    snapshot.forEach(function(data) {
     count+=1;
     var val = data.val();
                content +='<tr>';
                //  content += '<td>' + count + '</td>';
                content += '<td>'+'<b style="margin-left: 30%;">' + val.username + '</b>' + '</td>';
                content += '<td>' + '<b style="margin-left: 30%;">' + val.Harga + '</b>' + '</td>';
                content += '<td> <button class="btn btn-danger" onclick="hapusData(' + data.key + ')" style="margin-left: 10%;"> Hapus</button> <button class="btn btn-primary tampilModalUbah" onclick="setData('+ data.key +')" data-toggle="modal" data-target="#exampleModal" style="margin-left: 5%;">Edit</button>  </td>';
                content +='</tr>';
                key = 0;
                key = parseInt(data.key, 10);
     key = key + 1;
    });

    content += '</tbody>';
    $('#tbl_list_user').append(content);
   }else{
    $("#tbl_list_user tbody").remove(); 
   }  
  });


  function tambahData(){
   if($('#exampleModalLabel').text() == "Tambah Data Baru"){
    if(key == 0){
     key = 1;
    }

    database.ref('users/' + key).set({
     username: $('#nama').val(),
     Harga   : $('#Harga').val(),

    });

    alert("Data Berhasil ditambah");
   }else if($('#exampleModalLabel').text() == "Ubah Data"){
    database.ref('users/' + $('#id').val()).update({
     username: $('#nama').val(),
     Harga   : $('#Harga').val(),

    });
    alert("Data Berhasil diupdate");
   }
  } 


  function cleardata(){
   $('#nama').val("");
   $('#Harga').val("");
  }


  function setData(id){
   $('#exampleModalLabel').html('Ubah Data');   
   database.ref('users/').child(id).once('value').then( function(snap) {
       const user = snap.val()
       $('#id').val(id);
    $('#nama').val(user.username);
    $('#Harga').val(user.Harga);

   });
  }


  function hapusData(id){
   var answer = confirm("Hapus Data..?");
   if (answer) {
       database.ref('users/' + id).remove();
       alert("Data Berhasil dihapus");
   }
  } 

$('.btnTambahData').on('click', function(){
        $('#exampleModalLabel').html('Tambah Data Baru');
    });

 </script>
</body>
</html>